---
title: "Stats"
author: "Julia Prein"
date: "12/17/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse) # data handling etc.
library(viridis) # col scales, plotting...
library(ggpubr)
library(ggthemes)
library(tidyboot) # for bootstrap CIs
library(brms) # modeling
library(splithalfr) # reliability 

options(scipen = 999)
theme_set(theme_classic())
```

```{r load_data}
testtrials <- readRDS(file = "../data/gafo-testtrials.rds") %>% 
  # determine order of factors
  mutate(
    targetPosition = factor(targetPosition, levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "box1", "box2", "box3", "box4", "box5")), 
    studyversion = factor(studyversion, levels = c("hedge", "box")), 
    datacollection = factor(datacollection, levels = c("in-person - supervised", "remote - unsupervised")),
    sample = factor(sample, levels = c("kids", "adults")), 
    studytype = factor(studytype, levels = c("vali", "vali2", "reli")),
    
    # for models, summarize targetPositions in a way that it's symmetrical for left/ right side
    # the smaller the value, the more central the position
    symmetricPosition = case_when(
                                  targetPosition == "5" | targetPosition == "6" | targetPosition == "box3" ~ 1, 
                                  targetPosition == "4" | targetPosition == "7" | targetPosition == "box2" | targetPosition == "box4" ~ 2,
                                  targetPosition == "3" | targetPosition == "8" | targetPosition == "box1" | targetPosition == "box5" ~ 3, 
                                  targetPosition == "2" | targetPosition == "9" ~ 4,
                                  targetPosition == "1" | targetPosition == "10" ~ 5, 
                       ), 
    
    # distance between target and click in balloon widths (balloon width is 160 SVG units)
    clickDistInBalloons = clickDistInBalloons,
  )
```

# VARIATION

```{r vali_data}
vali <- testtrials %>% 
  filter(studytype == "vali" & (ageInYears < 6 | ageInYears == 18)) %>% 
  mutate(ageInYears = factor(ageInYears, levels = c("3", "4", "5", "18")))
```

```{r variation_hedge_preparateData}
variationHedgeInd <- vali %>% 
  filter(studyversion == "hedge") %>% 
  mutate(
    ageInYearsExact = ifelse(sample == "kids", ageInMonths/12, 18), 
    ageInMonthsCentered = scale(ageInYearsExact, center = TRUE, scale = TRUE)[,1],
  ) %>% 
  group_by(sample, datacollection, ageInYears, ageInYearsExact, ageInMonthsCentered, subjID) %>%
  summarise(mean = mean(clickDistInBalloons, na.rm = TRUE))

variationHedge <- variationHedgeInd %>%
  group_by(sample, datacollection, ageInYears) %>%
  tidyboot_mean(column = mean)
```

```{r variation_hedge_plot}
hedge_variation_plot <- ggplot() +
  # child data
  geom_smooth(
    data = variationHedgeInd %>% filter(sample == "kids"),  
    aes(x = ageInYearsExact, y = mean, group = datacollection, lty = datacollection), 
    method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey",
  ) + 
  
  geom_point(
    data = variationHedgeInd %>% filter(sample == "kids"), 
    aes(x = ageInYearsExact, y = mean, col = ageInYears, shape = datacollection, alpha = datacollection)
  ) +
  
  geom_pointrange(
    data = variationHedge %>% filter(sample == "kids"), 
    aes(x = as.numeric(as.character(ageInYears))+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = ageInYears, shape = datacollection, alpha = datacollection), size = 0.8, position=position_dodge(width = 0.1)
  ) +
  
  scale_shape_manual(values = c(16, 18)) + 
  scale_alpha_discrete(range = c(1, 0.4)) + 
  scale_linetype_manual(values = c("solid", "dashed")) + 
  
  # adult data
  geom_jitter(
    data = variationHedgeInd %>% filter(sample == "adults"), 
    aes(x = 6.5, y = mean, col = ageInYears, shape = datacollection), alpha = 0.5, width = .05, height = .01,  
  ) +

  geom_pointrange(
    data = variationHedge %>% filter(sample == "adults"), 
    aes(x = 6.5, y = mean, ymin = ci_lower, ymax = ci_upper, shape = datacollection), 
    size = 0.8,
  ) +
  
  labs(x = "Age in years", y = "Average imprecision in target width", col = "Age group", shape = "Data collection mode", alpha = "Data collection mode", lty = "Data collection mode") + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d", "darkgrey"), breaks = c("3", "4", "5", "18"), labels = c("3-year-olds", "4-year-olds", "5-year-olds", "Adults")) +
  scale_y_continuous(limits = c(0, 5), breaks = seq(0, 5, 1)) + 
  scale_x_continuous(breaks = seq(3, 6.5, 0.5), labels = c("3.0", "3.5", "4.0", "4.5", "5.0", "5.5", "6.0", "Adults")) + 

  theme(legend.text = element_text(size = 8),
        legend.key.size = unit(0.4, "cm"), 
        legend.direction = "vertical", 
        legend.box = "horizontal",
        legend.position = c(0.72, 0.85), 
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black")
        )

hedge_variation_plot

ggsave("../figures/gafo_hedge_variation.png", width = 7, height = 4)
```

```{r age_hedge_model}
mDataAgeHedge <- vali %>% 
  filter(studyversion == "hedge" & sample == "kids") %>% 
  mutate(
    # scaled (centered around mean, SD = 1, i.e., z-transformed)
    age = scale(ageInMonths, center = TRUE, scale = TRUE)[,1], 
  ) %>% 
  select(subjID, age, datacollection, symmetricPosition, targetPosition, clickDistInBalloons)

mAgeHedge <- brm(clickDistInBalloons ~ age + datacollection + (symmetricPosition | subjID) + (1 | targetPosition),
                    data = mDataAgeHedge,
                    family = lognormal(),
                    warmup = 1000, 
                    iter   = 3000, 
                    chains = 4, 
                    inits  = "random",
                    cores  = 4)
```

```{r variation_box_prepareData}
variationBoxInd <- vali %>% 
  filter(studyversion == "box") %>% 
  mutate(
    ageInYearsExact = ifelse(sample == "kids", ageInMonths/12, 18), 
    ageInMonthsCentered = scale(ageInYearsExact, center = TRUE, scale = TRUE)[,1],
  ) %>% 
  group_by(sample, datacollection, ageInYears, ageInYearsExact, ageInMonthsCentered, subjID) %>% 
  summarise(mean = mean(correctBox, na.rm = TRUE))

variationBox <- variationBoxInd %>%
  group_by(sample, datacollection, ageInYears) %>%
  tidyboot_mean(column = mean)
```

```{r variation_box_plot}
# with remote sample
box_variation_plot <- ggplot() +
  # chance level
  geom_segment(aes(x = 3.0, y = 0.2, xend = 6.2, yend = 0.2), lty = "dotted") + 
  geom_segment(aes(x = 6.25, y = 0.125, xend = 6.75, yend = 0.125), lty = "dotted") + 
  
  # child data
  geom_smooth(
    data = variationBoxInd %>% filter(sample == "kids"),  
    aes(x = ageInYearsExact, y = mean, group = datacollection, lty = datacollection), 
    method = "glm", size = 0.5, alpha = 0.15, col = "darkgrey",
  ) + 
  
  geom_point(
    data = variationBoxInd %>% filter(sample == "kids"), 
    aes(x = ageInYearsExact, y = mean, col = ageInYears, shape = datacollection, alpha = datacollection)
  ) +
  
  geom_pointrange(
    data = variationBox %>% filter(sample == "kids"), 
    aes(x = as.numeric(as.character(ageInYears))+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = ageInYears, shape = datacollection, alpha = datacollection), size = 0.8, position=position_dodge(width = 0.1)
  ) +
  
  scale_shape_manual(values = c(16, 18)) + 
  scale_alpha_discrete(range = c(1, 0.4)) + 
  scale_linetype_manual(values = c("solid", "dashed")) + 
  
  # adult data
  geom_jitter(
    data = variationBoxInd %>% filter(sample == "adults"), 
    aes(x = 6.5, y = mean, col = ageInYears, shape = datacollection), alpha = 0.5, width = .05, height = .01,  
  ) +

  geom_pointrange(
    data = variationBox %>% filter(sample == "adults"), 
    aes(x = 6.5, y = mean, ymin = ci_lower, ymax = ci_upper, shape = datacollection), 
    size = 0.8,
  ) +
  
  labs(x = "Age in years", y = "Proportion correct", col = "Age in years", shape = "Data collection mode", alpha = "Data collection mode", lty = "Data collection mode") + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d", "darkgrey"), breaks = c("3", "4", "5", "18"), labels = c("3-year-olds", "4-year-olds", "5-year-olds", "Adults")) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) + 
  scale_x_continuous(breaks = seq(3, 6.5, 0.5), labels = c("3.0", "3.5", "4.0", "4.5", "5.0", "5.5", "6.0", "Adults")) + 
  theme(legend.position="none")

box_variation_plot

ggsave("../figures/gafo_box_variation.png", width = 5, height = 4)
```

```{r age_box_model}
# define data
mDataAgeBox <- vali %>% 
  filter(studyversion == "box" & sample == "kids") %>% 
  mutate(
    # scaled (centered around mean, SD = 1, i.e., z-transformed)
    age = scale(ageInMonths, center = TRUE, scale = TRUE)[,1], 
  ) %>% 
  select(subjID, age, datacollection, symmetricPosition, targetPosition, correctBox)

mAgeBox <- brm(correctBox ~ age + datacollection + (symmetricPosition | subjID) + (1 | targetPosition),
                    data = mDataAgeBox,
                    family = bernoulli(link = "logit"),
                    warmup = 1000, 
                    iter   = 3000, 
                    chains = 4, 
                    inits  = "random",
                    cores  = 4)
```

# RELI

```{r reli_data}
reli <- testtrials %>% 
  filter(studytype == "reli" & (ageInYears < 6 | ageInYears == 18) & completedReli == TRUE) %>% 
  mutate(ageInYears = factor(ageInYears, levels = c("3", "4", "5", "18")))

reli %>%
  group_by(subjID) %>%
  slice(1) %>%
  ungroup() %>% 
  select(ageInYears, studyversion) %>%
  ftable()
```

## Internal consistency
```{r intCon_hedge_data}
# take data of first reli day for internal consistency
hedge_intCon <- reli %>% 
  filter(studyversion == "hedge" & reliday == "reliday1") %>% 
  mutate(
    testhalf = ifelse(trialNr %% 2 == 0, "even_trials", "odd_trials")
  ) %>% 
  group_by(subjID, testhalf, sample, ageInYears) %>%
  tidyboot_mean(column = clickDistInBalloons, na.rm = TRUE)

hedge_intCon <- hedge_intCon %>% 
  select(-c(n, empirical_stat)) %>% 
  group_by(subjID, testhalf) %>%
  pivot_wider(
    names_from = testhalf,
    values_from = c(mean, ci_lower, ci_upper)
  ) %>%
  ungroup()

# summary
psych::describeBy(hedge_intCon, hedge_intCon$sample)
```

```{r intCon_hedge_kids}
hedge_intCon_kids <- hedge_intCon %>% 
  filter(sample == "kids") %>% 
  ggplot(., aes(x = mean_even_trials, y = mean_odd_trials)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(aes(col = ageInYears), size = 0.7) + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d"), guide = "none") +
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 5, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 5), breaks = seq(0, 5, 1)) +
  scale_y_continuous(limits = c(0, 5), breaks = seq(0, 5, 1)) +
  labs(x = "Even trials", y = "Odd trials")

hedge_intCon_kids

ggsave("../figures/gafo_hedge_intCon_kids.png", width = 6, height = 4)
```

```{r intCon_hedge_adults}
hedge_intCon_adults <- hedge_intCon %>% 
  filter(sample == "adults") %>% 
  ggplot(., aes(x = mean_even_trials, y = mean_odd_trials)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(col = "darkgrey", size = 1.2, shape = 18, alpha = 0.5) + 
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 2, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 2), breaks = seq(0, 2, 0.5)) +
  scale_y_continuous(limits = c(0, 2), breaks = seq(0, 2, 0.5)) +
  labs(x = "Even trials", y = "Odd trials")

hedge_intCon_adults

ggsave("../figures/gafo_hedge_intCon_adults.png", width = 6, height = 4)
```

```{r intCon_box_data}
# take data of first reli day for internal consistency
box_intCon <- reli %>% 
  filter(studyversion == "box" & reliday == "reliday1") %>% 
  mutate(
    testhalf = ifelse(trialNr %% 2 == 0, "even_trials", "odd_trials")
  ) %>% 
  group_by(subjID, testhalf, sample, ageInYears) %>%
  tidyboot_mean(column = correctBox, na.rm = TRUE)

box_intCon <- box_intCon %>% 
  select(-c(n, empirical_stat)) %>% 
  group_by(subjID, testhalf) %>%
  pivot_wider(
    names_from = testhalf,
    values_from = c(mean, ci_lower, ci_upper)
  ) %>%
  ungroup()

# summary
psych::describeBy(box_intCon, box_intCon$sample)
```

```{r intCon_box_kids}
box_intCon_kids <- box_intCon %>% 
  filter(sample == "kids") %>% 
  ggplot(., aes(x = mean_even_trials, y = mean_odd_trials)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(aes(col = ageInYears), size = 0.7) + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d"), guide = "none") +
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 1, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(breaks = seq(0, 1, 0.2)) +
  scale_y_continuous(breaks = seq(0, 1, 0.2)) +
  labs(x = "Even trials", y = "Odd trials")

box_intCon_kids

ggsave("../figures/gafo_box_intCon_kids.png", width = 6, height = 4)
```

```{r intCon_box_adults}
box_intCon_adults <- box_intCon %>% 
  filter(sample == "adults") %>% 
  ggplot(., aes(x = mean_even_trials, y = mean_odd_trials)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(col = "darkgrey", size = 1.2, shape = 18, alpha = 0.5) + 
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 1, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  labs(x = "Even trials", y = "Odd trials")

box_intCon_adults

ggsave("../figures/gafo_box_intCon_adults.png", width = 6, height = 4)
```

```{r splithalfr_hedge_kids}
fn_score_hedge <- function(ds) {
  return(mean(clickDistInBalloons, na.rm = TRUE))
}

hedge_intCon_data <- reli %>% 
  filter(studyversion == "hedge" & reliday == "reliday1")

# random split
splitscores_hedge_random_kids <- by_split(
  hedge_intCon_data %>% filter(sample == "kids"),
  hedge_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_hedge,
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
)

hedge_random_kids <- split_coefs(splitscores_hedge_random_kids, cor)
hedge_random_kids_ci  <- split_ci(splitscores_hedge_random_kids, cor)

# create dataframe to save data
splithalf_data <- tibble(
                    studyversion = "hedge", 
                    sample = "kids", 
                    split = "random", 
                    stratification = "none", 
                    mean = hedge_random_kids, 
                    CI_lower = hedge_random_kids_ci$lims["0.025","bca"], 
                    CI_upper = hedge_random_kids_ci$lims["0.975","bca"])

# random split with stratification by target position
splitscores_hedge_randomStrat_kids <- by_split(
  hedge_intCon_data %>% filter(sample == "kids"),
  hedge_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_hedge,
  stratification = hedge_intCon_data %>% filter(sample == "kids") %>% pull(symmetricPosition),
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
)

hedge_randomStrat_kids <- split_coefs(splitscores_hedge_randomStrat_kids, cor)
hedge_randomStrat_kids_ci <- split_ci(splitscores_hedge_randomStrat_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "kids", 
                                        split = "random",
                                        stratification = "target position",
                                        mean = hedge_randomStrat_kids, 
                                        CI_lower = hedge_randomStrat_kids_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_randomStrat_kids_ci$lims["0.975","bca"]
                                      )

# odd even split
splitscores_hedge_oddeven_kids <- by_split(
  hedge_intCon_data %>% filter(sample == "kids"),
  hedge_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_hedge,
  replications = 10000,
  method = c("odd_even"),
)

hedge_oddeven_kids <- split_coefs(splitscores_hedge_oddeven_kids, cor)
hedge_oddeven_kids_ci  <- split_ci(splitscores_hedge_oddeven_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "kids", 
                                        split = "odd even", 
                                        stratification = "none", 
                                        mean = hedge_oddeven_kids, 
                                        CI_lower = hedge_oddeven_kids_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_oddeven_kids_ci$lims["0.975","bca"]
                                      )

# odd even split with stratification by target position
splitscores_hedge_oddevenStrat_kids <- by_split(
  hedge_intCon_data %>% filter(sample == "kids"),
  hedge_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_hedge,
  stratification = hedge_intCon_data %>% filter(sample == "kids") %>% pull(symmetricPosition),
  replications = 10000,
  method = c("odd_even"),
)

hedge_oddevenStrat_kids <- split_coefs(splitscores_hedge_oddevenStrat_kids, cor)
hedge_oddevenStrat_kids_ci <- split_ci(splitscores_hedge_oddevenStrat_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "kids", 
                                        split = "odd even",
                                        stratification = "target position",
                                        mean = hedge_oddevenStrat_kids, 
                                        CI_lower = hedge_oddevenStrat_kids_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_oddevenStrat_kids_ci$lims["0.975","bca"]
                                      )

# first second testhalves split
splitscores_hedge_firstsecond_kids <- by_split(
  hedge_intCon_data %>% filter(sample == "kids"),
  hedge_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_hedge,
  replications = 10000,
  method = c("first_second"),
)

hedge_firstsecond_kids <- split_coefs(splitscores_hedge_firstsecond_kids, cor)
hedge_firstsecond_kids_ci <- split_ci(splitscores_hedge_firstsecond_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "kids", 
                                        split = "first second", 
                                        stratification = "none",                                        
                                        mean = hedge_firstsecond_kids, 
                                        CI_lower = hedge_firstsecond_kids_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_firstsecond_kids_ci$lims["0.975","bca"]
                                      )

# first second testhalves split with stratification by target position
splitscores_hedge_firstsecondStrat_kids <- by_split(
  hedge_intCon_data %>% filter(sample == "kids"),
  hedge_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_hedge,
  stratification = hedge_intCon_data %>% filter(sample == "kids") %>% pull(symmetricPosition),
  replications = 10000,
  method = c("odd_even"),
)

hedge_firstsecondStrat_kids <- split_coefs(splitscores_hedge_firstsecondStrat_kids, cor)
hedge_firstsecondStrat_kids_ci <- split_ci(splitscores_hedge_firstsecondStrat_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "kids", 
                                        split = "first second",
                                        stratification = "target position",
                                        mean = hedge_firstsecondStrat_kids, 
                                        CI_lower = hedge_firstsecondStrat_kids_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_firstsecondStrat_kids_ci$lims["0.975","bca"]
                                      )
```

```{r splithalfr_hedge_adults}
# random split
splitscores_hedge_random_adults <- by_split(
  hedge_intCon_data %>% filter(sample == "adults"),
  hedge_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_hedge,
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
)

hedge_random_adults <- split_coefs(splitscores_hedge_random_adults, cor)
hedge_random_adults_ci  <- split_ci(splitscores_hedge_random_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "adults", 
                                        split = "random", 
                                        stratification = "none", 
                                        mean = hedge_random_adults, 
                                        CI_lower = hedge_random_adults_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_random_adults_ci$lims["0.975","bca"]
                                      )

# random split with stratification by target position
splitscores_hedge_randomStrat_adults <- by_split(
  hedge_intCon_data %>% filter(sample == "adults"),
  hedge_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_hedge,
  stratification = hedge_intCon_data %>% filter(sample == "adults") %>% pull(symmetricPosition),
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
)

hedge_randomStrat_adults <- split_coefs(splitscores_hedge_randomStrat_adults, cor)
hedge_randomStrat_adults_ci <- split_ci(splitscores_hedge_randomStrat_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "adults", 
                                        split = "random",
                                        stratification = "target position",
                                        mean = hedge_randomStrat_adults, 
                                        CI_lower = hedge_randomStrat_adults_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_randomStrat_adults_ci$lims["0.975","bca"]
                                      )

# odd even split
splitscores_hedge_oddeven_adults <- by_split(
  hedge_intCon_data %>% filter(sample == "adults"),
  hedge_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_hedge,
  replications = 10000,
  method = c("odd_even"),
)

hedge_oddeven_adults <- split_coefs(splitscores_hedge_oddeven_adults, cor)
hedge_oddeven_adults_ci  <- split_ci(splitscores_hedge_oddeven_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "adults", 
                                        split = "odd even", 
                                        stratification = "none", 
                                        mean = hedge_oddeven_adults, 
                                        CI_lower = hedge_oddeven_adults_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_oddeven_adults_ci$lims["0.975","bca"]
                                      )

# odd even split with stratification by target position
splitscores_hedge_oddevenStrat_adults <- by_split(
  hedge_intCon_data %>% filter(sample == "adults"),
  hedge_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_hedge,
  stratification = hedge_intCon_data %>% filter(sample == "adults") %>% pull(symmetricPosition),
  replications = 10000,
  method = c("odd_even"),
)

hedge_oddevenStrat_adults <- split_coefs(splitscores_hedge_oddevenStrat_adults, cor)
hedge_oddevenStrat_adults_ci <- split_ci(splitscores_hedge_oddevenStrat_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "adults", 
                                        split = "odd even",
                                        stratification = "target position",
                                        mean = hedge_oddevenStrat_adults, 
                                        CI_lower = hedge_oddevenStrat_adults_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_oddevenStrat_adults_ci$lims["0.975","bca"]
                                      )

# first second testhalves split
splitscores_hedge_firstsecond_adults <- by_split(
  hedge_intCon_data %>% filter(sample == "adults"),
  hedge_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_hedge,
  replications = 10000,
  method = c("first_second"),
)

hedge_firstsecond_adults <- split_coefs(splitscores_hedge_firstsecond_adults, cor)
hedge_firstsecond_adults_ci <- split_ci(splitscores_hedge_firstsecond_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "adults", 
                                        split = "first second", 
                                        stratification = "none",                                        
                                        mean = hedge_firstsecond_adults, 
                                        CI_lower = hedge_firstsecond_adults_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_firstsecond_adults_ci$lims["0.975","bca"]
                                      )

# first second testhalves split with stratification by target position
splitscores_hedge_firstsecondStrat_adults <- by_split(
  hedge_intCon_data %>% filter(sample == "adults"),
  hedge_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_hedge,
  stratification = hedge_intCon_data %>% filter(sample == "adults") %>% pull(symmetricPosition),
  replications = 10000,
  method = c("odd_even"),
)

hedge_firstsecondStrat_adults <- split_coefs(splitscores_hedge_firstsecondStrat_adults, cor)
hedge_firstsecondStrat_adults_ci <- split_ci(splitscores_hedge_firstsecondStrat_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "hedge", 
                                        sample = "adults", 
                                        split = "first second",
                                        stratification = "target position",
                                        mean = hedge_firstsecondStrat_adults, 
                                        CI_lower = hedge_firstsecondStrat_adults_ci$lims["0.025","bca"], 
                                        CI_upper = hedge_firstsecondStrat_adults_ci$lims["0.975","bca"]
                                      )
```

```{r splithalfr_box_kids}
fn_score_box <- function(ds) {
  return(mean(ds$correctBox, na.rm = TRUE))
}

box_intCon_data <- reli %>% 
  filter(studyversion == "box" & reliday == "reliday1") 

box_intCon_data %>% 
  group_by(subjID, targetPosition) %>% 
  summarise(n = n()) %>% 
  filter(n < 2)

# random split
splitscores_box_random_kids <- by_split(
  box_intCon_data %>% filter(sample == "kids"),
  box_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_box,
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
)

box_random_kids <- split_coefs(splitscores_box_random_kids, cor)
box_random_kids_ci  <- split_ci(splitscores_box_random_kids, cor)

# create dataframe to save data
splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "kids", 
                                        split = "random", 
                                        stratification = "none", 
                                        mean = box_random_kids, 
                                        CI_lower = box_random_kids_ci$lims["0.025","bca"], 
                                        CI_upper = box_random_kids_ci$lims["0.975","bca"])

# random split with stratification by target position
splitscores_box_randomStrat_kids <- by_split(
  box_intCon_data %>% filter(sample == "kids"),
  box_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_box,
  stratification = box_intCon_data %>% filter(sample == "kids") %>% pull(targetPosition),
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
  careful = FALSE, 
)

box_randomStrat_kids <- split_coefs(splitscores_box_randomStrat_kids, cor)
box_randomStrat_kids_ci <- split_ci(splitscores_box_randomStrat_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "kids", 
                                        split = "random",
                                        stratification = "target position",
                                        mean = box_randomStrat_kids, 
                                        CI_lower = box_randomStrat_kids_ci$lims["0.025","bca"], 
                                        CI_upper = box_randomStrat_kids_ci$lims["0.975","bca"]
                                      )

# odd even split
splitscores_box_oddeven_kids <- by_split(
  box_intCon_data %>% filter(sample == "kids"),
  box_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_box,
  replications = 10000,
  method = c("odd_even"),
)

box_oddeven_kids <- split_coefs(splitscores_box_oddeven_kids, cor)
box_oddeven_kids_ci  <- split_ci(splitscores_box_oddeven_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "kids", 
                                        split = "odd even", 
                                        stratification = "none", 
                                        mean = box_oddeven_kids, 
                                        CI_lower = box_oddeven_kids_ci$lims["0.025","bca"], 
                                        CI_upper = box_oddeven_kids_ci$lims["0.975","bca"]
                                      )

# odd even split with stratification by target position
splitscores_box_oddevenStrat_kids <- by_split(
  box_intCon_data %>% filter(sample == "kids"),
  box_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_box,
  stratification = box_intCon_data %>% filter(sample == "kids") %>% pull(targetPosition),
  replications = 10000,
  method = c("odd_even"),
  careful = FALSE
)

box_oddevenStrat_kids <- split_coefs(splitscores_box_oddevenStrat_kids, cor)
box_oddevenStrat_kids_ci <- split_ci(splitscores_box_oddevenStrat_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "kids", 
                                        split = "odd even",
                                        stratification = "target position",
                                        mean = box_oddevenStrat_kids, 
                                        CI_lower = box_oddevenStrat_kids_ci$lims["0.025","bca"], 
                                        CI_upper = box_oddevenStrat_kids_ci$lims["0.975","bca"]
                                      )

# first second testhalves split
splitscores_box_firstsecond_kids <- by_split(
  box_intCon_data %>% filter(sample == "kids"),
  box_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_box,
  replications = 10000,
  method = c("first_second"),
)

box_firstsecond_kids <- split_coefs(splitscores_box_firstsecond_kids, cor)
box_firstsecond_kids_ci <- split_ci(splitscores_box_firstsecond_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "kids", 
                                        split = "first second", 
                                        stratification = "none",                                        
                                        mean = box_firstsecond_kids, 
                                        CI_lower = box_firstsecond_kids_ci$lims["0.025","bca"], 
                                        CI_upper = box_firstsecond_kids_ci$lims["0.975","bca"]
                                      )

# first second testhalves split with stratification by target position
splitscores_box_firstsecondStrat_kids <- by_split(
  box_intCon_data %>% filter(sample == "kids"),
  box_intCon_data %>% filter(sample == "kids") %>% pull(subjID),
  fn_score_box,
  stratification = box_intCon_data %>% filter(sample == "kids") %>% pull(targetPosition),
  replications = 10000,
  method = c("odd_even"),
  careful = FALSE,
)

box_firstsecondStrat_kids <- split_coefs(splitscores_box_firstsecondStrat_kids, cor)
box_firstsecondStrat_kids_ci <- split_ci(splitscores_box_firstsecondStrat_kids, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "kids", 
                                        split = "first second",
                                        stratification = "target position",
                                        mean = box_firstsecondStrat_kids, 
                                        CI_lower = box_firstsecondStrat_kids_ci$lims["0.025","bca"], 
                                        CI_upper = box_firstsecondStrat_kids_ci$lims["0.975","bca"]
                                      )
```

```{r splithalfr_box_adults}
# random split
splitscores_box_random_adults <- by_split(
  box_intCon_data %>% filter(sample == "adults"),
  box_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_box,
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
)

box_random_adults <- split_coefs(splitscores_box_random_adults, cor)
box_random_adults_ci  <- split_ci(splitscores_box_random_adults, cor)

# create dataframe to save data
splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "adults", 
                                        split = "random", 
                                        stratification = "none", 
                                        mean = box_random_adults, 
                                        CI_lower = box_random_adults_ci$lims["0.025","bca"], 
                                        CI_upper = box_random_adults_ci$lims["0.975","bca"]
                                      )

# random split with stratification by target position
splitscores_box_randomStrat_adults <- by_split(
  box_intCon_data %>% filter(sample == "adults"),
  box_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_box,
  stratification = box_intCon_data %>% filter(sample == "adults") %>% pull(targetPosition),
  replications = 10000,
  method = c("random"),
  replace = TRUE,
  split_p = 1,
  careful = FALSE,
)

box_randomStrat_adults <- split_coefs(splitscores_box_randomStrat_adults, cor)
box_randomStrat_adults_ci <- split_ci(splitscores_box_randomStrat_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "adults", 
                                        split = "random",
                                        stratification = "target position",
                                        mean = box_randomStrat_adults, 
                                        CI_lower = box_randomStrat_adults_ci$lims["0.025","bca"], 
                                        CI_upper = box_randomStrat_adults_ci$lims["0.975","bca"]
                                      )

# odd even split
splitscores_box_oddeven_adults <- by_split(
  box_intCon_data %>% filter(sample == "adults"),
  box_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_box,
  replications = 10000,
  method = c("odd_even"),
)

box_oddeven_adults <- split_coefs(splitscores_box_oddeven_adults, cor)
box_oddeven_adults_ci  <- split_ci(splitscores_box_oddeven_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "adults", 
                                        split = "odd even", 
                                        stratification = "none", 
                                        mean = box_oddeven_adults, 
                                        CI_lower = box_oddeven_adults_ci$lims["0.025","bca"], 
                                        CI_upper = box_oddeven_adults_ci$lims["0.975","bca"]
                                      )

# odd even split with stratification by target position
splitscores_box_oddevenStrat_adults <- by_split(
  box_intCon_data %>% filter(sample == "adults"),
  box_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_box,
  stratification = box_intCon_data %>% filter(sample == "adults") %>% pull(targetPosition),
  replications = 10000,
  method = c("odd_even"),
  careful = FALSE,
)

box_oddevenStrat_adults <- split_coefs(splitscores_box_oddevenStrat_adults, cor)
box_oddevenStrat_adults_ci <- split_ci(splitscores_box_oddevenStrat_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "adults", 
                                        split = "odd even",
                                        stratification = "target position",
                                        mean = box_oddevenStrat_adults, 
                                        CI_lower = box_oddevenStrat_adults_ci$lims["0.025","bca"], 
                                        CI_upper = box_oddevenStrat_adults_ci$lims["0.975","bca"]
                                      )

# first second testhalves split
splitscores_box_firstsecond_adults <- by_split(
  box_intCon_data %>% filter(sample == "adults"),
  box_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_box,
  replications = 10000,
  method = c("first_second"),
)

box_firstsecond_adults <- split_coefs(splitscores_box_firstsecond_adults, cor)
box_firstsecond_adults_ci <- split_ci(splitscores_box_firstsecond_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "adults", 
                                        split = "first second", 
                                        stratification = "none",                                        
                                        mean = box_firstsecond_adults, 
                                        CI_lower = box_firstsecond_adults_ci$lims["0.025","bca"], 
                                        CI_upper = box_firstsecond_adults_ci$lims["0.975","bca"]
                                      )

# first second testhalves split with stratification by target position
splitscores_box_firstsecondStrat_adults <- by_split(
  box_intCon_data %>% filter(sample == "adults"),
  box_intCon_data %>% filter(sample == "adults") %>% pull(subjID),
  fn_score_box,
  stratification = box_intCon_data %>% filter(sample == "adults") %>% pull(targetPosition),
  replications = 10000,
  method = c("odd_even"),
  careful = FALSE,
)

box_firstsecondStrat_adults <- split_coefs(splitscores_box_firstsecondStrat_adults, cor)
box_firstsecondStrat_adults_ci <- split_ci(splitscores_box_firstsecondStrat_adults, cor)

splithalf_data <- splithalf_data %>% add_row(
                                        studyversion = "box", 
                                        sample = "adults", 
                                        split = "first second",
                                        stratification = "target position",
                                        mean = box_firstsecondStrat_adults, 
                                        CI_lower = box_firstsecondStrat_adults_ci$lims["0.025","bca"], 
                                        CI_upper = box_firstsecondStrat_adults_ci$lims["0.975","bca"]
                                      )
```

```{r splithalf_plot}
splithalf_data %>% 
  mutate(sample = fct_rev(sample)) %>%
  unite("samplegroup", c(studyversion, sample), sep = " - ", remove = FALSE) %>% 
  mutate(samplegroup = fct_rev(samplegroup)) %>%
  unite("method", c(split, stratification), sep = ", ", remove = FALSE) %>% 
  ggplot(aes(x = method, y = mean, color = sample, group = studyversion)) + 
    geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), colour = "black", width = .1, position = position_dodge(0.1)) +
    geom_point(position = position_dodge(0.1), size = 3) +
    scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
    scale_color_manual(values = c("#006c66", "darkgrey"), guide = "none") +
    labs(x = "Splitting & stratification method", y = "") +
    coord_flip() + 
    facet_wrap(~ samplegroup) + 
    theme(legend.position = "none", panel.spacing = unit(1.5, "lines"))

ggsave("../figures/gafo_splithalf.png", width = 6, height = 4, scale = 1.4)
```

```{r splithalf_table}
knitr::kable(splithalf_data)
```

```{r save_splithalf_data}
write.csv(splithalf_data, "gafo-splithalf.csv", quote = F, row.names = F)
saveRDS(splithalf_data, file = "gafo-splithalf.rds")
```

## Test-retest reliability 

```{r retest_hedge_data}
# take data of first reli day for internal consistency
hedge_retest <- reli %>% 
  filter(studyversion == "hedge") %>% 
  group_by(subjID, reliday, sample, ageInYears) %>% 
  tidyboot_mean(column = clickDistInBalloons, na.rm = TRUE)

hedge_retest <- hedge_retest %>% 
  select(-c(n, empirical_stat)) %>% 
  group_by(subjID, reliday) %>%
  pivot_wider(
    names_from = reliday,
    values_from = c(mean, ci_lower, ci_upper)
  ) %>%
  ungroup()

# summary
psych::describeBy(hedge_retest, hedge_retest$sample)

# exclude 1 outlier
hedge_retest <- hedge_retest %>% 
  filter(mean_reliday1 < mean(mean_reliday1) + 3*sd(mean_reliday1), mean_reliday1 > mean(mean_reliday1) - 3*sd(mean_reliday1), 
         mean_reliday2 < mean(mean_reliday2) + 3*sd(mean_reliday2), mean_reliday2 > mean(mean_reliday2) - 3*sd(mean_reliday2))
```

```{r retest_hedge_kids}
hedge_retest_kids <- hedge_retest %>% 
  filter(sample == "kids") %>% 
  ggplot(., aes(x = mean_reliday1, y = mean_reliday2)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(aes(col = ageInYears), size = 0.7) + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d"), guide = "none") +
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 4, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 4), breaks = seq(0, 4, 1)) +
  scale_y_continuous(limits = c(0, 4), breaks = seq(0, 4, 1)) +
  labs(x = "Testday 1", y = "Testday 2")

hedge_retest_kids

ggsave("../figures/gafo_hedge_retest_kids.png", width = 6, height = 4)
```

```{r retest_hedge_adults}
hedge_retest_adults <- hedge_retest %>% 
  filter(sample == "adults") %>% 
  ggplot(., aes(x = mean_reliday1, y = mean_reliday2)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(col = "darkgrey", size = 1.2, shape = 18, alpha = 0.5) + 
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 2, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 2), breaks = seq(0, 2, 0.5)) +
  scale_y_continuous(limits = c(0, 2), breaks = seq(0, 2, 0.5)) +
  labs(x = "Testday 1", y = "Testday 2")

hedge_retest_adults

ggsave("../figures/gafo_hedge_retest_adults.png", width = 6, height = 4)
```

```{r retest_box_data}
# take data of first reli day for internal consistency
box_retest <- reli %>% 
  filter(studyversion == "box") %>% 
  group_by(subjID, reliday, sample, ageInYears) %>% 
  tidyboot_mean(column = correctBox, na.rm = TRUE)

box_retest <- box_retest %>% 
  select(-c(n, empirical_stat)) %>% 
  group_by(subjID, reliday) %>%
  pivot_wider(
    names_from = reliday,
    values_from = c(mean, ci_lower, ci_upper)
  ) %>%
  ungroup()

# summary
psych::describeBy(box_retest, box_retest$sample)
```

```{r retest_box_kids}
box_retest_kids <- box_retest %>% 
  filter(sample == "kids") %>% 
  ggplot(., aes(x = mean_reliday1, y = mean_reliday2)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(aes(col = ageInYears), size = 0.7) + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d"), guide = "none") +
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 1, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  labs(x = "Testday 1", y = "Testday 2")

box_retest_kids

ggsave("../figures/gafo_hedge_retest_kids.png", width = 6, height = 4)
```

```{r retest_box_adults}
box_retest_adults <- box_retest %>% 
  filter(sample == "adults") %>% 
  ggplot(., aes(x = mean_reliday1, y = mean_reliday2)) + 
  geom_abline(intercept = 0, slope = 1, col = "darkgrey", linetype = "longdash") +
  geom_point(col = "darkgrey", size = 1.2, shape = 18, alpha = 0.5) + 
  geom_smooth(method = "lm", size = 0.5, alpha = 0.15, col = "darkgrey") +
  stat_cor(method = "pearson", label.x = 0, label.y = 1, aes(label = paste(..r.label..)), size = 3.5, r.accuracy = 0.01, cor.coef.name = "r") + 
  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
  labs(x = "Testday 1", y = "Testday 2")

box_retest_adults

ggsave("../figures/gafo_hedge_retest_adults.png", width = 6, height = 4)
```

```{r retest_hedge_model}
# define data
mDataRetestHedge <- reli %>% 
  filter(studyversion == "hedge" & sample == "kids") %>% 
  mutate(
    # scaled (centered around mean, SD = 1, i.e., z-transformed)
    age = scale(ageInMonths, center = TRUE, scale = TRUE)[,1], 
  ) %>% 
  select(subjID, age, reliday, clickDistInBalloons)

# run model
mRetestHedge <- brm(clickDistInBalloons ~ age + (0 + reliday | subjID), 
                              data   = mDataRetestHedge, 
                              family = lognormal(), 
                              warmup = 1000, 
                              iter   = 3000, 
                              chains = 4, 
                              inits  = "random",
                              cores  = 4)
```

```{r retest_box_model}
# define data
mDataRetestBox <- reli %>% 
  filter(studyversion == "box" & sample == "kids") %>% 
  mutate(
    # scaled (centered around mean, SD = 1, i.e., z-transformed)
    age = scale(ageInMonths, center = TRUE, scale = TRUE)[,1], 
  ) %>% 
  select(subjID, age, reliday, correctBox)

# run model
mRetestBox <- brm(correctBox ~ age + (0 + reliday | subjID), 
                              data   = mDataRetestBox, 
                              family = bernoulli(link = "logit"),
                              warmup = 1000, 
                              iter   = 3000, 
                              chains = 4, 
                              inits  = "random",
                              cores  = 4)
```

# Save plots

```{r arrange_plots}
ggarrange(

  ggarrange(hedge_variation_plot,
            NULL,
            ggarrange(
              hedge_intCon_kids, 
              hedge_intCon_adults,
              hedge_retest_kids, 
              hedge_retest_adults, 
              nrow = 2, 
              ncol = 2, 
              labels = c("B", "C", "D", "E")
            ), 
            
            # hedge: space between vari and reli
            nrow = 1, widths = c(1, 0.06, 1),
            labels = c("A", "", "")
  ), 
  
  NULL, 
  
  ggarrange(box_variation_plot,
            NULL,
            ggarrange(
              box_intCon_kids,
              box_intCon_adults,
              box_retest_kids,
              box_retest_adults,
              nrow = 2, 
              ncol = 2,
              labels = c("G", "H", "I", "J")
            ), 
  
            # box: space between vari and reli
            nrow = 1, widths = c(1, 0.06, 1),
            labels = c("F", "", "")
  ), 
  
  # space between hedge & box
  nrow = 3, heights = c(1.2, 0.1, 1.2)
)

ggsave("../figures/gafo_results.png", width = 6.5, height = 5, scale = 1.6, bg = "white")
```

```{r save_model_output}
# mcor <- model_cor %>%
#     mutate(task = recode(task,
#                     `mutual_exclusivity` = "Mutual Exclusivity",
#                     `informativeness` = "Informativeness Inference (1)",
#                     `simple_inf` = "Informativeness Inference (2)",
#                     `preference` = "Speaker Preference",
#                     `novelty` = "Discourse Novelty",
#                     `card_sorting` = "Card Sorting",
#                     `discourse_continuity` = "Discourse Continuity",
#                     `ad_hoc_implicature` = "Ad-hoc Implicature",
#                     `match_to_sample` = "Relational Match-to-sample"),
#            term = task, 
#            mcor = Estimate, 
#            mcor_lci = `l-95% CI`, 
#            mcor_uci = `u-95% CI`)%>%
#   select(study, term, task, mcor, mcor_lci, mcor_uci)

# saveRDS(mcor, "model_results.rds")
```

