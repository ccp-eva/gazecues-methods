---
title: "Stats"
author: "Julia Prein"
date: "12/17/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(viridis) # color scales
library(ggpubr)
library(tidyboot)
library(ggthemes)
library(brms)

options(scipen = 999)
theme_set(theme_classic())
```

```{r load_data}
testtrials <- readRDS(file = "../data/gafo-testtrials.rds") %>% 
  # determine order of factors
  mutate(
    targetPosition = factor(targetPosition, levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "box1", "box2", "box3", "box4", "box5")), 
    studyversion = factor(studyversion, levels = c("hedge", "box")), 
    datacollection = factor(datacollection, levels = c("in-person - supervised", "remote - unsupervised")),
    sample = factor(sample, levels = c("kids", "adults")), 
    studytype = factor(studytype, levels = c("vali", "vali2", "reli"))
  )
```

```{r vali_data}
vali <- testtrials %>% 
  filter(studytype == "vali" & (ageInYears < 6 | ageInYears == 18))
```

```{r variation_hedge_preparateData}
variationHedgeInd <- vali %>% 
  filter(studyversion == "hedge") %>% 
  mutate(
    ageInYearsExact = ifelse(sample == "kids", ageInMonths/12, 18), 
    ageInMonthsCentered = scale(ageInYearsExact, center = TRUE, scale = TRUE)[,1],
  ) %>% 
  group_by(sample, datacollection, ageInYears, ageInYearsExact, ageInMonthsCentered, subjID) %>%
  summarise(mean = mean(abs(clickDistFromTargetCenterX)/160, na.rm = TRUE))

variationHedge <- variationHedgeInd %>%
  group_by(sample, datacollection, ageInYears) %>%
  tidyboot_mean(column = mean)
```

```{r variation_hedge}
## variation without remote kids
ggplot() +
  # child data
  geom_smooth(data = variationHedgeInd %>% filter(sample == "kids" & datacollection == "in-person - supervised"),  aes(x = ageInYearsExact, y = mean), method = "glm", color = "darkgrey", alpha = 0.2) +
  geom_point(data = variationHedgeInd %>% filter(sample == "kids" & datacollection == "in-person - supervised"), aes(x = ageInYearsExact, y = mean, col = as.factor(ageInYears)), alpha = .5) +
  geom_pointrange(data = variationHedge %>% filter(sample == "kids" & datacollection == "in-person - supervised"), aes(x = as.numeric(as.character(ageInYears))+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = as.factor(ageInYears)), size = 0.8, pch = 18) + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d"), labels = c("3-year-olds", "4-year-olds", "5-year-olds")) +
  
  # adult data
  geom_jitter(data = variationHedgeInd %>% filter(sample == "adults"), aes(x = 6.5, y = mean), alpha = .15, width = .05, height = .01) +
  geom_pointrange(data = variationHedge %>% filter(sample == "adults"), aes(x = 6.5, y = mean, ymin = ci_lower, ymax = ci_upper), size = 0.8, pch = 18) +  
  labs(x = "Age in years", y = "Average imprecision in target width", color = "Age group") + 
  scale_y_continuous(limits = c(0, 5), breaks = seq(0, 5, 1)) + 
  scale_x_continuous(breaks = seq(3, 6.5, 0.5), labels = c("3.0", "3.5", "4.0", "4.5", "5.0", "5.5", "6.0", "Adults")) + 
  theme(legend.position = c(0.11, 0.18))

ggsave("../figures/gafo_hedge_variation.png", width = 6, height = 4)
```

```{r variation_hedge_remote}
# with remote sample
ggplot() +
  # child data
  geom_smooth(data = variationHedgeInd %>% filter(sample == "kids"),  aes(x = ageInYearsExact, y = mean, group = datacollection, col = datacollection), method = "glm", alpha = 0.2, size = 0.5) + 
  geom_point(data = variationHedgeInd %>% filter(sample == "kids"), aes(x = ageInYearsExact, y = mean, col = datacollection), alpha = .25) +
  geom_pointrange(data = variationHedge %>% filter(sample == "kids"), aes(x = as.numeric(as.character(ageInYears))+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = datacollection), size = 0.8, pch = 18, position=position_dodge(width = 0.1)) +
  scale_color_manual(values = c("#00b1ea", "#29485d"), labels = c("in-person - supervised", "remote - unsupervised")) +
  
  # adult data
  geom_jitter(data = variationHedgeInd %>% filter(sample == "adults"), aes(x = 6.5, y = mean), alpha = .15, width = .05, height = .01) +
  geom_pointrange(data = variationHedge %>% filter(sample == "adults"), aes(x = 6.5, y = mean, ymin = ci_lower, ymax = ci_upper), size = 0.8, pch = 18) +
  
  labs(x = "Age in years", y = "Average imprecision in target width", color = "Data collection mode") + 
  scale_y_continuous(limits = c(0, 5), breaks = seq(0, 5, 1)) + 
  scale_x_continuous(breaks = seq(3, 6.5, 0.5), labels = c("3.0", "3.5", "4.0", "4.5", "5.0", "5.5", "6.0", "Adults")) + 
  theme(legend.position = c(0.85, 0.88))

ggsave("../figures/gafo_hedge_remote.png", width = 6, height = 4)
```

```{r variation_box_prepareData}
variationBoxInd <- vali %>% 
  filter(studyversion == "box") %>% 
  mutate(
    ageInYearsExact = ifelse(sample == "kids", ageInMonths/12, 18), 
    ageInMonthsCentered = scale(ageInYearsExact, center = TRUE, scale = TRUE)[,1],
  ) %>% 
  group_by(sample, datacollection, ageInYears, ageInYearsExact, ageInMonthsCentered, subjID) %>% 
  summarise(mean = mean(correctBox, na.rm = TRUE))

variationBox <- variationBoxInd %>%
  group_by(sample, datacollection, ageInYears) %>%
  tidyboot_mean(column = mean)
```

```{r variation_box} 
ggplot() +
  # chance level
  geom_hline(aes(yintercept = 0.2), lty = 1) + 
  geom_hline(aes(yintercept = 0.125), lty = 2) + 
  
  # child data
  geom_smooth(data = variationBoxInd %>% filter(sample == "kids" & datacollection == "in-person - supervised"),  aes(x = ageInYearsExact, y = mean), method = "glm", color = "darkgrey", alpha = 0.2) +
  geom_point(data = variationBoxInd %>% filter(sample == "kids" & datacollection == "in-person - supervised"), aes(x = ageInYearsExact, y = mean, col = as.factor(ageInYears)), alpha = .5) +
  geom_pointrange(data = variationBox %>% filter(sample == "kids" & datacollection == "in-person - supervised"), aes(x = as.numeric(as.character(ageInYears))+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = as.factor(ageInYears)), size = 0.8, pch = 18) + 
  scale_color_manual(values = c("#00b1ea", "#006c66", "#29485d"), labels = c("3-year-olds", "4-year-olds", "5-year-olds")) +
  
  # adult data
  geom_jitter(data = variationBoxInd %>% filter(sample == "adults"), aes(x = 6.5, y = mean), alpha = .15, width = .05, height = .01) +
  geom_pointrange(data = variationBox %>% filter(sample == "adults"), aes(x = 6.5, y = mean, ymin = ci_lower, ymax = ci_upper), size = 0.8, pch = 18) +  
  labs(x = "Age in years", y = "Proportion correct", color = "Age group") + 
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) + 
  scale_x_continuous(breaks = seq(3, 6.5, 0.5), labels = c("3.0", "3.5", "4.0", "4.5", "5.0", "5.5", "6.0", "Adults")) + 
  theme(legend.position = c(0.11, 0.85))

ggsave("../figures/gafo_box_variation.png", width = 6, height = 4)
```

```{r variation_box_remote}
# with remote sample
ggplot() +
  # chance level
  geom_hline(aes(yintercept = 0.2), lty = 1) + 
  geom_hline(aes(yintercept = 0.125), lty = 2) + 
  
  # child data
  geom_smooth(data = variationBoxInd %>% filter(sample == "kids"),  aes(x = ageInYearsExact, y = mean, group = datacollection, col = datacollection), method = "glm", alpha = 0.2, size = 0.5) +
  geom_point(data = variationBoxInd %>% filter(sample == "kids"), aes(x = ageInYearsExact, y = mean, col = datacollection), alpha = .25) +
  geom_pointrange(data = variationBox %>% filter(sample == "kids"), aes(x = as.numeric(as.character(ageInYears))+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = datacollection), size = 0.8, pch = 18, position=position_dodge(width = 0.1)) +
  scale_color_manual(values = c("#00b1ea", "#29485d"), labels = c("in-person - supervised", "remote - unsupervised")) +
  
  # adult data
  geom_jitter(data = variationBoxInd %>% filter(sample == "adults"), aes(x = 6.5, y = mean), alpha = .15, width = .05, height = .01) +
  geom_pointrange(data = variationBox %>% filter(sample == "adults"), aes(x = 6.5, y = mean, ymin = ci_lower, ymax = ci_upper), size = 0.8, pch = 18) +
  
  labs(x = "Age in years", y = "Average imprecision in target width", color = "Data collection mode") + 
  scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) + 
  scale_x_continuous(breaks = seq(3, 6.5, 0.5), labels = c("3.0", "3.5", "4.0", "4.5", "5.0", "5.5", "6.0", "Adults")) + 
  theme(legend.position = c(0.17, 0.9))

ggsave("../figures/gafo_box_remote.png", width = 6, height = 4)
```